<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <title>02 JS 内存管理和闭包 | knzn.net</title><meta name="description" content="大前端知识分享网站">
    <link rel="preload" href="/vuepress-theme-knzn/assets/js/runtime~app.813766ea.js" as="script"><link rel="preload" href="/vuepress-theme-knzn/assets/css/styles.e822ef45.css" as="style"><link rel="preload" href="/vuepress-theme-knzn/assets/js/4666.93202135.js" as="script"><link rel="preload" href="/vuepress-theme-knzn/assets/js/app.4f9d344d.js" as="script"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-9f3fcaa4.1b8ca017.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-899df890.09b6ae47.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-0a92fa36.c8154151.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-7e12ee98.ea409588.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-2756a4b2.c827a271.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-4428dfb1.cdd55c69.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/5830.c7d14f1b.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-24469f5c.fed244a8.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-664c577c.4443cfa5.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-1615bf52.f6a4b0a5.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-1e1b0228.ff0d1544.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-4684fb5a.8fa12255.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-51279dfe.10753b06.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-1596fbeb.a493a0b0.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-3641ecee.f04a9f36.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-7210f09e.4a291e07.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-49e03b1e.d403c109.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-5d2dded8.ad037719.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-84092c86.cbf0b000.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-07472075.d2d0b6ac.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-30fc8ec7.42ac014b.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-0de0fd96.39a63124.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-5f0b136e.efcc68af.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-7b104bd6.5de5dd33.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-2a736f02.93378e2e.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-48879aae.467d076e.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-4a2f069e.0fd28b7d.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-1fc42db6.309a4dba.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-cecc57f4.7ec8d97c.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-556b6df8.3f7753f9.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-efe2c25a.c05f07e5.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/8079.c3bbc0d7.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-13aca52b.5f2890c7.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-39d47cec.b095f558.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-6716b9b1.a7afa784.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-bdde92d8.a85726bb.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-a0470d1c.3b3e1376.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-27af4b01.88558619.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-19883268.b6d07af2.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-3834afdd.8ce98132.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-4764e1c4.323ecaea.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-cde3a97a.66d17771.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-0a5a2de4.fd182ec9.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-4a07565a.baf81ffb.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-0694520a.9395274c.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-1f11a6a2.b9de4cbc.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-1de687f6.e2f1e47f.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-7674e22b.3881a6d0.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-3fe4c5db.f0977706.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-7cc9c600.db4246f5.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/5605.8e40b379.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-264a61dd.554cf62b.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-37bafd5f.a4387baa.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-8d22c02c.a1971170.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-6cf7166b.95f85595.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-107f0ee0.0986e08e.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-5dcf7aa0.28698412.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-1cfef914.27126c21.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-d4b9630c.4c721cab.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-747344c8.179a589e.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-e84a6406.5a4b0ce1.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-6e5a5958.164e411a.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-0055d228.eb370598.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-0a376634.7765f8cb.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-4c6c05e0.e99c93d2.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-674fc706.921e8137.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-09203a14.f4f28e23.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-6abe350c.bc37b7e8.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-64137a1e.aa37f341.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/9330.a23ca85d.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-2dd7a0c9.dbc0e214.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/7534.7858fa5b.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-3dcc8dff.42250acb.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-bdaff392.264d8f98.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-6999f94a.06eb3a10.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-a108ccdc.689881e9.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-4b722f0b.767c2d6d.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-2d2eb624.17f2ac5f.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-598ebf6a.27894a63.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/1493.621b4732.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-361ecdc5.995029ba.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/2872.274d6544.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-55704082.491dc0c8.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-48bf88b6.21774e00.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/7517.c75a898e.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/8427.53575c78.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-fabbb680.bd7bc1cb.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/9163.9349bcf1.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-19fc749d.e1711379.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-c960de4e.e8c2aaad.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/7042.9829b4c6.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/2994.73b50e07.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-2086c098.b2f1a9fc.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-0b2fb86c.15b0a646.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-8daa1a0e.09d6f4b3.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-1152bc8b.c50629ae.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-e355b60c.06f74233.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-41507b24.5692ccfc.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-15534fdd.59203458.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/js/v-3706649a.f26a483b.js"><link rel="prefetch" href="/vuepress-theme-knzn/assets/css/6286.styles.2808748c.css">
    <link rel="stylesheet" href="/vuepress-theme-knzn/assets/css/styles.e822ef45.css">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><header class="theme-header" is-logo="true"><a href="/vuepress-theme-knzn/" class="logo-link" style=""><img src="/vuepress-theme-knzn/images/logo-light.svg" alt class="logo"><strong class="title">knzn.net</strong></a><!----><nav class="navbar"><i class="iconfont icon-menu menu-btn"></i><ul class="nav-list"><li class="nav-item"><div class="navbar-blogger"><div class="avatar"><img src="/vuepress-theme-knzn/images/avatar.jpg" alt="头像" title="头像"></div><div class="types"><a href="/vuepress-theme-knzn/categories/?category=all" class="type"><span class="text">分类</span><span class="num">82</span></a><div class="divider"></div><a href="/vuepress-theme-knzn/tags/?tag=all" class="type"><span class="text">标签</span><span class="num">89</span></a></div><div class="blogger"><div class="name">前端程序猿</div><p class="slogan" title="种一棵树最好的时间是十年前，其次是现在！">种一棵树最好的时间是十年前，其次是现在！</p></div></div></li><!--[--><li class="nav-link nav-item"><a href="/vuepress-theme-knzn/dbe1806c869181db9c55afecd31d39b9/" class="navbar-item"><!----><span class="text">主题配置</span></a></li><li class="nav-link nav-item"><a href="/vuepress-theme-knzn/PostsLayout" class="navbar-item"><!----><span class="text">深入理解JavaScript</span></a></li><li class="nav-link nav-item"><a href="/vuepress-theme-knzn/PostsLayout" class="navbar-item"><!----><span class="text">TypeScript学习笔记</span></a></li><li class="nav-link nav-item"><div class="navbar-dropdown"><div class="dropdown-header"><span class="title">杂谈</span><span class="arrow"></span></div><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress-theme-knzn/PostsLayout" class="navbar-item"><!----><span class="text">linux笔记</span></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-theme-knzn/PostsLayout" class="navbar-item"><!----><span class="text">git笔记</span></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-theme-knzn/PostsLayout" class="navbar-item"><!----><span class="text">js笔记</span></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-theme-knzn/PostsLayout" class="navbar-item"><!----><span class="text">mongoDB笔记</span></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-theme-knzn/PostsLayout" class="navbar-item"><!----><span class="text">mysql笔记</span></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-theme-knzn/PostsLayout" class="navbar-item"><!----><span class="text">python笔记</span></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-theme-knzn/PostsLayout" class="navbar-item"><!----><span class="text">工具</span></a></li><!--]--></ul></div></li><!--]--><li class="nav-link nav-item"><button class="theme-toggle"><i class="icon-sun iconfont"></i></button></li><li class="nav-link nav-item search-link"><a href="/vuepress-theme-knzn/search/" class="navbar-item"><i class="icon-search iconfont"></i><span class="text">搜索</span></a></li><li class="nav-item nav-medias"><div class="medias"><!--[--><a class="icon-email iconfont" href="mailto:1140457303@qq.com" title="email" target="_blank"></a><a class="icon-QQ iconfont" href="http://wpa.qq.com/msgrd?v=3&amp;uin=1140457303&amp;site=qq&amp;menu=yes" title="QQ" target="_blank"></a><a class="icon-jianshu iconfont" href="https://www.jianshu.com/u/f22487800f07" title="jianshu" target="_blank"></a><a class="icon-gitee iconfont" href="https://gitee.com/zhanghuanbiao" title="gitee" target="_blank"></a><a class="icon-github iconfont" href="https://github.com/zhb333" title="github" target="_blank"></a><!--]--></div></li></ul></nav></header><!--[--><main class="theme-container theme-post-container"><aside class="post-aside"><ul class="menu-list"><!--[--><li id="01 深入 JavaScript 运行原理" class="menu-item"><a href="/vuepress-theme-knzn/c2ace350cb0fa9cce1b7b44ed46f3f0d/" class="navbar-item"><!----><span class="text">01 深入 JavaScript 运行原理</span></a></li><li id="02 JS 内存管理和闭包" class="active menu-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/" class="router-link-active router-link-exact-active navbar-item"><!----><span class="text">02 JS 内存管理和闭包</span></a></li><li id="03 JS 函数的 this 指向" class="menu-item"><a href="/vuepress-theme-knzn/96caea2fef4c43453a8cb08ed7c58a16/" class="navbar-item"><!----><span class="text">03 JS 函数的 this 指向</span></a></li><li id="04 call、apply、bind" class="menu-item"><a href="/vuepress-theme-knzn/b184b427b0636d3295955d2162fe49c7/" class="navbar-item"><!----><span class="text">04 call、apply、bind</span></a></li><li id="05 JS 函数式编程" class="menu-item"><a href="/vuepress-theme-knzn/e3cd770a3c5be15e69f68cd2caf91eca/" class="navbar-item"><!----><span class="text">05 JS 函数式编程</span></a></li><li id="06 JS 额外知识补充" class="menu-item"><a href="/vuepress-theme-knzn/994032c06194e94a353d375e514ab0ba/" class="navbar-item"><!----><span class="text">06 JS 额外知识补充</span></a></li><li id="07 深入 JS 面向对象 一" class="menu-item"><a href="/vuepress-theme-knzn/f6c7fa139994de84ba32680da702f009/" class="navbar-item"><!----><span class="text">07 深入 JS 面向对象 一</span></a></li><li id="08 深入 JS 面向对象 二" class="menu-item"><a href="/vuepress-theme-knzn/2ae22576c9ea8d6e7f2da95e6b7977ed/" class="navbar-item"><!----><span class="text">08 深入 JS 面向对象 二</span></a></li><li id="09 深入 JS 面向对象继承" class="menu-item"><a href="/vuepress-theme-knzn/2be6e0b7e482e9529da3fb159823fdef/" class="navbar-item"><!----><span class="text">09 深入 JS 面向对象继承</span></a></li><li id="10 JS 对象的方法补充" class="menu-item"><a href="/vuepress-theme-knzn/72503ece7180a91f8011faad5fcda61d/" class="navbar-item"><!----><span class="text">10 JS 对象的方法补充</span></a></li><li id="11 ES6 中类的使用" class="menu-item"><a href="/vuepress-theme-knzn/6d2f625a38cea21df3fa81d978b7d936/" class="navbar-item"><!----><span class="text">11 ES6 中类的使用</span></a></li><li id="12 ES6 知识点讲解" class="menu-item"><a href="/vuepress-theme-knzn/3158f72d8efcc81e5ac5ef8ffe25b31b/" class="navbar-item"><!----><span class="text">12 ES6 知识点讲解</span></a></li><li id="13 ES7-ES12 知识点解析" class="menu-item"><a href="/vuepress-theme-knzn/e4a23be1b843a692a1f2a78941f54351/" class="navbar-item"><!----><span class="text">13 ES7-ES12 知识点解析</span></a></li><li id="14 Proxy-Reflect vue2-vue3 响应式原理" class="menu-item"><a href="/vuepress-theme-knzn/2f6bc3632ff70a8c4cd1034e70199505/" class="navbar-item"><!----><span class="text">14 Proxy-Reflect vue2-vue3 响应式原理</span></a></li><li id="15 响应式原理实现" class="menu-item"><a href="/vuepress-theme-knzn/a539d57c4f17db547472704b023301f6/" class="navbar-item"><!----><span class="text">15 响应式原理实现</span></a></li><li id="16 Promise 使用详解" class="menu-item"><a href="/vuepress-theme-knzn/1913ee79c22125082785541a989f2561/" class="navbar-item"><!----><span class="text">16 Promise 使用详解</span></a></li><li id="17 手写 Promise" class="menu-item"><a href="/vuepress-theme-knzn/e64fd176d5fb7e21475505c517e88855/" class="navbar-item"><!----><span class="text">17 手写 Promise</span></a></li><li id="18 Iterator-Generator" class="menu-item"><a href="/vuepress-theme-knzn/db72ec0b0b33d8b4f153ea4d71c1b091/" class="navbar-item"><!----><span class="text">18 Iterator-Generator</span></a></li><!--]--></ul></aside><div class="theme-content post-container"><div class="post-wrapper"><i class="iconfont icon-book toc-btn"></i><i class="iconfont icon-menu aside-btn"></i><div class="markdown-body"><h1 class="post-title"><span>02 JS 内存管理和闭包</span></h1><div class="post-info"><span class="post-info-item"><i class="iconfont icon-avatar" title="作者"></i> 前端程序猿</span><span class="post-info-item"><i class="iconfont icon-datetime" title="日期"></i> 2022-07-29</span><span class="post-info-item"><i class="iconfont icon-categorynormal" title="分类"></i><!--[--><a href="/vuepress-theme-knzn/categories/?category=%E5%A4%A7%E5%89%8D%E7%AB%AF" class="post-type">大前端</a><!--]--></span><span class="post-info-item"><i class="iconfont icon-tag" title="标签"></i><!--[--><a href="/vuepress-theme-knzn/tags/?tag=javascript" class="post-type">javascript</a><!--]--></span></div><div><p>不管什么样的编程语言，在代码的执行过程中都是需要给它分配内存的，不同的是某些编程语言需要我们自己手动 的管理内存，某些编程语言会可以自动帮助我们管理内存：</p><h2 id="认识内存管理" tabindex="-1"><a class="header-anchor" href="#认识内存管理" aria-hidden="true">#</a> 认识内存管理</h2><p>不管以什么样的方式来管理内存，内存的管理都会有如下的生命周期：</p><ul><li>第一步：分配申请你需要的内存（申请）；</li><li>第二步：使用分配的内存（存放一些东西，比如对象等）；</li><li>第三步：不需要使用时，对其进行释放；</li></ul><p>不同的编程语言对于第一步和第三步会有不同的实现：</p><ul><li>手动管理内存：比如 C、C++，包括早期的 OC，都是需要手动来管理内存的申请和释放的（malloc 和 free 函 数）；</li><li>自动管理内存：比如 Java、JavaScript、Python、Swift、Dart 等，它们有自动帮助我们管理内存；</li></ul><p>我们可以知道 JavaScript 通常情况下是不需要手动来管理的。JavaScript 会在定义变量时为我们分配内存。</p><p>但是内存分配方式是一样的吗？</p><p>JS 对于基本数据类型内存的分配会在执行时， 直接在栈空间进行分配；JS 对于复杂数据类型内存的分配会在堆内存 中开辟一块空间，并且将这块空间的指针返 回值变量引用；</p><p><img src="/vuepress-theme-knzn/assets/img/1.46c654ae.jpg" alt="JS内存结构"></p><h2 id="js-的垃圾回收" tabindex="-1"><a class="header-anchor" href="#js-的垃圾回收" aria-hidden="true">#</a> JS 的垃圾回收</h2><p>因为内存的大小是有限的，所以当内存不再需要的时候，我们需要对其进行释放，以便腾出更多的内存空间。</p><p>在手动管理内存的语言中，我们需要通过一些方式自己来释放不再需要的内存，比如 free 函数：</p><ul><li>但是这种管理的方式其实非常的低效，影响我们编写逻辑的代码的效率；</li><li>并且这种方式对开发者的要求也很高，并且一不小心就会产生内存泄露；</li></ul><p>所以大部分现代的编程语言都是有自己的垃圾回收机制：</p><ul><li>垃圾回收的英文是 Garbage Collection，简称 GC；</li><li>对于那些不再使用的对象，我们都称之为是垃圾，它需要被回收，以释放更多的内存空间；</li><li>而我们的语言运行环境，比如 Java 的运行环境 JVM，JavaScript 的运行环境 js 引擎都会内存 垃圾回收器；</li><li>垃圾回收器我们也会简称为 GC，所以在很多地方你看到 GC 其实指的是垃圾回收器；</li></ul><p>但是这里又出现了另外一个很关键的问题：GC 怎么知道哪些对象是不再使用的呢？这里就要用到 GC 的算法了</p><h2 id="常见的-gc-算法-–-引用计数" tabindex="-1"><a class="header-anchor" href="#常见的-gc-算法-–-引用计数" aria-hidden="true">#</a> 常见的 GC 算法 – 引用计数</h2><p>引用计数：当一个对象有一个引用指向它时，那么这个对象的引用就+1，当一个对象的引用为 0 时，这个对象就可以被销 毁掉；这个算法有一个很大的弊端就是会产生循环引用；</p><p>这个算法有一个很大的弊端就是会产生循环引用；</p><p><img src="/vuepress-theme-knzn/assets/img/2.954bda30.jpg" alt="循环引用"></p><h2 id="常见的-gc-算法-–-标记清除" tabindex="-1"><a class="header-anchor" href="#常见的-gc-算法-–-标记清除" aria-hidden="true">#</a> 常见的 GC 算法 – 标记清除</h2><p>标记清除：</p><p>这个算法是设置一个根对象（root object），垃圾回收器会定期从这个根开始，找所有从根开始有引用到的对象，对 于哪些没有引用到的对象，就认为是不可用的对象；</p><p>这个算法可以很好的解决循环引用的问题；</p><p><img src="/vuepress-theme-knzn/assets/img/3.69bf6846.jpg" alt="标记清除"></p><p>JS 引擎比较广泛的采用的就是标记清除算法，当然类似于 V8 引擎为了进行更好的优化，它在算法的实现细节上也会结合 一些其他的算法。</p><h2 id="让人迷惑的闭包" tabindex="-1"><a class="header-anchor" href="#让人迷惑的闭包" aria-hidden="true">#</a> 让人迷惑的闭包</h2><p>闭包是 JavaScript 中一个非常容易让人迷惑的知识点：</p><p>这几天看到有同学在深入 JS 高级的交流群中发了这么一张图片；并且闭包也是群里面大家讨论最多的一个话题； <img src="/vuepress-theme-knzn/assets/img/4.6cc4f2d3.jpg" alt="让人迷惑的闭包"></p><p>闭包确实是 JavaScript 中一个很难理解的知识点，接下来我们就对其一步步来进行剖析，看看它到底有什么神奇之 处</p><h2 id="js-中函数是一等公民" tabindex="-1"><a class="header-anchor" href="#js-中函数是一等公民" aria-hidden="true">#</a> JS 中函数是一等公民</h2><p>在 JavaScript 中，函数是非常重要的，并且是一等公民：那么就意味着函数的使用是非常灵活的；函数可以作为另外一个函数的参数，也可以作为另外一个函数的返回值来使用；</p><ul><li>自己编写高阶函数</li><li>使用内置的高阶函数</li></ul><h2 id="js-中闭包的定义" tabindex="-1"><a class="header-anchor" href="#js-中闭包的定义" aria-hidden="true">#</a> JS 中闭包的定义</h2><p>这里先来看一下闭包的定义，分成两个：在计算机科学中和在 JavaScript 中。</p><h3 id="在计算机科学中对闭包的定义-维基百科" tabindex="-1"><a class="header-anchor" href="#在计算机科学中对闭包的定义-维基百科" aria-hidden="true">#</a> 在计算机科学中对闭包的定义（维基百科）</h3><ul><li>闭包（英语：Closure），又称词法闭包（Lexical Closure）或函数闭包（function closures）；</li><li>是在支持 头等函数 的编程语言中，实现词法绑定的一种技术；</li><li>闭包在实现上是一个结构体，它存储了一个函数和一个关联的环境（相当于一个符号查找表）；</li><li>闭包跟函数最大的区别在于，当捕捉闭包的时候，它的 自由变量 会在补充时被确定，这样即使脱离了捕捉时的上下文，它也能照常运行；</li></ul><p>闭包的概念出现于 60 年代，最早实现闭包的程序是 Scheme，那么我们就可以理解为什么 JavaScript 中有闭包：因为 JavaScript 中有大量的设计是来源于 Scheme 的；</p><h3 id="我们再来看一下-mdn-对-javascript-闭包的解释" tabindex="-1"><a class="header-anchor" href="#我们再来看一下-mdn-对-javascript-闭包的解释" aria-hidden="true">#</a> 我们再来看一下 MDN 对 JavaScript 闭包的解释</h3><ul><li>一个函数和对其周围状态（lexical environment，词法环境）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是闭包（closure）；</li><li>也就是说，闭包让你可以在一个内层函数中访问到其外层函数的作用域；</li><li>在 JavaScript 中，每当创建一个函数，闭包就会在函数创建的同时被创建出来；</li></ul><h3 id="那么我的理解和总结" tabindex="-1"><a class="header-anchor" href="#那么我的理解和总结" aria-hidden="true">#</a> 那么我的理解和总结</h3><ul><li>一个普通的函数 function，如果它可以访问外层作用于的自由变量，那么这个函数就是一个闭包；</li><li>从广义的角度来说：JavaScript 中的函数都是闭包；</li><li>从狭义的角度来说：JavaScript 中一个函数，如果访问了外层作用于的变量，那么它是一个闭包；</li></ul><h2 id="闭包的访问过程" tabindex="-1"><a class="header-anchor" href="#闭包的访问过程" aria-hidden="true">#</a> 闭包的访问过程</h2><p>如果我们编写了如下的代码，它一定是形成了闭包的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">makeAdder</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> count <span class="token operator">+</span> num
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> add10 <span class="token operator">=</span> <span class="token function">makeAdder</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add10</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/vuepress-theme-knzn/assets/img/6.a4e44ba5.jpg" alt="闭包的访问过程"></p><h2 id="闭包的执行过程" tabindex="-1"><a class="header-anchor" href="#闭包的执行过程" aria-hidden="true">#</a> 闭包的执行过程</h2><p>那么函数继续执行呢？</p><p>这个时候 makeAdder 函数执行完毕，正常情况下我们的 AO 对象会被释放；但是因为在 0xb00 的函数中有作用域引用指向了这个 AO 对象，所以它不会被释放掉；</p><p><img src="/vuepress-theme-knzn/assets/img/7.644d4854.jpg" alt="闭包的执行过程"></p><h2 id="闭包的内存泄露" tabindex="-1"><a class="header-anchor" href="#闭包的内存泄露" aria-hidden="true">#</a> 闭包的内存泄露</h2><p>那么我们为什么经常会说闭包是有内存泄露的呢？</p><p>在上面的案例中，如果后续我们不再使用 add10 函数了，那么该函数对象应该要被销毁掉，并且其引用着的父 作用域 AO 也应该被销毁掉；</p><p>但是目前因为在全局作用域下 add10 变量对 0xb00 的函数对象有引用，而 0xb00 的作用域中 AO（0x200）有引 用，所以最终会造成这些内存都是无法被释放的；</p><p>所以我们经常说的闭包会造成内存泄露，其实就是刚才的引用链中的所有对象都是无法释放的；</p><p>那么，怎么解决这个问题呢？</p><p>因为当将 add10 设置为 null 时，就不再对函数对象 0xb00 有引用，那么对应的 AO 对象 0x200 也就不可达了；</p><p>在 GC 的下一次检测中，它们就会被销毁掉；</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>add10 <span class="token operator">=</span> <span class="token keyword">null</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="闭包的内存泄漏测试" tabindex="-1"><a class="header-anchor" href="#闭包的内存泄漏测试" aria-hidden="true">#</a> 闭包的内存泄漏测试</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">testArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> arrFns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    arrFns<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">testArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      arrFns<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/vuepress-theme-knzn/assets/img/8.62d532d4.jpg" alt="闭包的内存泄漏测试"></p><h2 id="ao-不使用的属性" tabindex="-1"><a class="header-anchor" href="#ao-不使用的属性" aria-hidden="true">#</a> AO 不使用的属性</h2><p>我们来研究一个问题：AO 对象不会被销毁时，是否里面的所有属性都不会被释放？</p><p>下面这段代码中 name 属于闭包的父作用域里面的变量；</p><p>我们知道形成闭包之后 count 一定不会被销毁掉，那么 name 是否会被销毁掉呢？</p><p>这里我打上了断点，我们可以在浏览器上看看结果；</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">makeAdder</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&#39;why&#39;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">debugger</span>
    <span class="token keyword">return</span> count <span class="token operator">+</span> num
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> add10 <span class="token operator">=</span> <span class="token function">makeAdder</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add10</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add10</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></div><div class="theme-divider"></div><div class="giscus-comment"><!----></div></div><div class="card-box card-wrapper post-tocs"><header><h3 class="title"><i class="iconfont icon-categorynormal"></i><span> 目录 </span></h3></header><nav class="vuepress-toc"><ul class="vuepress-toc-list"><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#认识内存管理" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="认识内存管理">认识内存管理</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#js-的垃圾回收" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="JS 的垃圾回收">JS 的垃圾回收</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#常见的-gc-算法-–-引用计数" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="常见的 GC 算法 – 引用计数">常见的 GC 算法 – 引用计数</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#常见的-gc-算法-–-标记清除" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="常见的 GC 算法 – 标记清除">常见的 GC 算法 – 标记清除</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#让人迷惑的闭包" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="让人迷惑的闭包">让人迷惑的闭包</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#js-中函数是一等公民" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="JS 中函数是一等公民">JS 中函数是一等公民</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#js-中闭包的定义" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="JS 中闭包的定义">JS 中闭包的定义</a><!--[--><ul class="vuepress-toc-list"><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#在计算机科学中对闭包的定义-维基百科" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="在计算机科学中对闭包的定义（维基百科）">在计算机科学中对闭包的定义（维基百科）</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#我们再来看一下-mdn-对-javascript-闭包的解释" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="我们再来看一下 MDN 对 JavaScript 闭包的解释">我们再来看一下 MDN 对 JavaScript 闭包的解释</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#那么我的理解和总结" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="那么我的理解和总结">那么我的理解和总结</a><!--[--><!--]--></li></ul><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#闭包的访问过程" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="闭包的访问过程">闭包的访问过程</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#闭包的执行过程" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="闭包的执行过程">闭包的执行过程</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#闭包的内存泄露" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="闭包的内存泄露">闭包的内存泄露</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#闭包的内存泄漏测试" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="闭包的内存泄漏测试">闭包的内存泄漏测试</a><!--[--><!--]--></li><li class="vuepress-toc-item"><a aria-current="page" href="/vuepress-theme-knzn/6b124f3a416ee9f7c29dfd6b27c772b7/#ao-不使用的属性" class="router-link-active router-link-exact-active vuepress-toc-link" arialabel="AO 不使用的属性">AO 不使用的属性</a><!--[--><!--]--></li></ul></nav></div></div></main><footer class="theme-footer theme-common-footer"><div class="copyright"><a class="beian" href="">粤ICP备20016112号-2</a><span class="delimiter">|</span><span class="info">Copyright © 2018-2022 knzn.net</span></div></footer><div style="display:none;" class="back-to-top"><i class="iconfont icon-back-to-top"></i></div><!--]--><!--]--><!--]--></div>
    <script src="/vuepress-theme-knzn/assets/js/runtime~app.813766ea.js" defer></script><script src="/vuepress-theme-knzn/assets/js/4666.93202135.js" defer></script><script src="/vuepress-theme-knzn/assets/js/app.4f9d344d.js" defer></script>
  </body>
</html>
